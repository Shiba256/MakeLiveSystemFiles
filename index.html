<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONファイル生成</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #0e0e0e;
            color: white;
            padding: 20px;
            margin: 0;
        }
        h1 {
            text-align: center;
        }
        .form-container {
            background-color: #222;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 153, 255, 0.7);
            border: 2px solid #333;
            max-width: 600px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="time"],
        textarea {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 2px solid #444;
            background-color: #333;
            color: white;
            box-shadow: 0 0 5px rgba(0, 153, 255, 0.5);
        }
        button {
            padding: 10px 20px;
            background-color: #00ccff;
            color: #000;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 0 5px rgba(0, 153, 255, 0.7);
            font-weight: bold;
            margin-right: 10px;
        }
        button:hover {
            background-color: #0099cc;
        }
        .song-group {
            margin-bottom: 30px;
        }
        .song-group hr {
            border: 1px solid #555;
            margin: 20px 0;
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .part-button {
            padding: 10px 20px;
            background-color: #444;
            color: white;
            border: 2px solid #555;
            border-radius: 5px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }
        .part-button.selected {
            background-color: #00ccff;
            color: black;
            box-shadow: 0 0 10px #00ccff;
        }
        .remove-song {
            background-color: #ff4444;
            color: white;
        }
        .remove-song:hover {
            background-color: #ff0000;
        }
    </style>
</head>
<body>

    <h1>JSONファイル生成ツール</h1>
    <div class="form-container">
        <div class="form-group">
            <label for="band-name">バンド名</label>
            <input type="text" id="band-name" placeholder="バンド名を入力してください">
        </div>
        <div id="songs-container">
            <div class="song-group" id="song-group-1">
                <h3>曲 1</h3>
                <label for="song-title-1">曲名</label>
                <input type="text" id="song-title-1" placeholder="曲名を入力してください">

                <label>使用するパート</label>
                <div class="checkbox-group">
                    <div class="part-button selected" data-part="Ba">Ba (ベース)</div>
                    <div class="part-button selected" data-part="Mr">Mr (マーシャル)</div>
                    <div class="part-button selected" data-part="Jc">Jc (ジャズギター)</div>
                    <div class="part-button selected" data-part="Dr">Dr (ドラム)</div>
                    <div class="part-button" data-part="EP">EP (スタジオのキーボード)</div>
                    <div class="part-button" data-part="m1">マイク1 (下手側)</div>
                    <div class="part-button selected" data-part="m2">マイク2 (センター)</div>
                    <div class="part-button" data-part="m3">マイク3 (上手側)</div>
                    <div class="part-button" data-part="m4">マイク4 (ドラム)</div>
                </div>

                <label for="song-detail-1">要望</label>
                <textarea id="song-detail-1" rows="3" placeholder="要望や詳細を入力してください"></textarea>

                <button class="remove-song">曲を削除</button>
                <hr>
            </div>
        </div>

        <button id="add-song">曲を追加</button>
        <button id="generate-json">JSONファイルを生成</button>
    </div>

    <script>
        let songCount = 1;

        document.getElementById('add-song').addEventListener('click', function() {
            // 曲を追加する前に全曲の番号をリセット
            resetSongNumbers();
            // 新しい曲グループを作成
            const songGroup = document.createElement('div');
            songGroup.classList.add('song-group');
            songGroup.id = `song-group-${songCount + 1}`; // 新しいIDを付与
            songGroup.innerHTML = `
                <h3>曲 ${songCount + 1}</h3>
                <label for="song-title-${songCount + 1}">曲名</label>
                <input type="text" id="song-title-${songCount + 1}" placeholder="曲名を入力してください">

                <label>使用するパート</label>
                <div class="checkbox-group">
                    <div class="part-button selected" data-part="Ba">Ba (ベース)</div>
                    <div class="part-button selected" data-part="Mr">Mr (マーシャル)</div>
                    <div class="part-button selected" data-part="Jc">Jc (ジャズギター)</div>
                    <div class="part-button selected" data-part="Dr">Dr (ドラム)</div>
                    <div class="part-button" data-part="EP">EP (スタジオのキーボード)</div>
                    <div class="part-button" data-part="m1">マイク1 (下手側)</div>
                    <div class="part-button selected" data-part="m2">マイク2 (センター)</div>
                    <div class="part-button" data-part="m3">マイク3 (上手側)</div>
                    <div class="part-button" data-part="m4">マイク4 (ドラム)</div>
                </div>

                <label for="song-detail-${songCount + 1}">要望</label>
             <textarea id="song-detail-${songCount + 1}" rows="3" placeholder="要望や詳細を入力してください"></textarea>

             <button class="remove-song">曲を削除</button>
              <hr>
            `;
            document.getElementById('songs-container').appendChild(songGroup);

            // 新しいパートボタンにイベントリスナーを追加
            addPartButtonEventListeners(songGroup);
            addRemoveSongEventListener(songGroup);

            // 曲番号を再設定
            resetSongNumbers();
        });

        // 曲番号をリセットする関数
        function resetSongNumbers() {
             const songGroups = document.querySelectorAll('.song-group');
             songGroups.forEach((songGroup, index) => {
                const songNumber = index + 1;
                songGroup.id = `song-group-${songNumber}`;
                songGroup.querySelector('h3').textContent = `曲 ${songNumber}`;
                songGroup.querySelector(`input[id^="song-title-"]`).id = `song-title-${songNumber}`;
                songGroup.querySelector(`textarea[id^="song-detail-"]`).id = `song-detail-${songNumber}`;
            });
        }

        // パートボタンのクリックイベントを設定する関数
        function addPartButtonEventListeners(songGroup) {
            const partButtons = songGroup.querySelectorAll('.part-button');
            partButtons.forEach(button => {
                button.addEventListener('click', function() {
                    button.classList.toggle('selected');
                });
            });
        }

        // 削除ボタンにイベントリスナーを追加する関数
        function addRemoveSongEventListener(songGroup) {
            const removeButton = songGroup.querySelector('.remove-song');
            removeButton.addEventListener('click', function() {
                songGroup.remove();
            });
        }

        // 初期のパートボタンと削除ボタンのイベントリスナーを設定
        addPartButtonEventListeners(document.getElementById('song-group-1'));
        addRemoveSongEventListener(document.getElementById('song-group-1'));

        // JSONファイルを生成する関数
        document.getElementById('generate-json').addEventListener('click', function() {
            const bandName = document.getElementById('band-name').value;
            const songs = [];

            document.querySelectorAll('.song-group').forEach((songGroup, index) => {
                const title = songGroup.querySelector(`#song-title-${index + 1}`).value;
                const uses = [];
                songGroup.querySelectorAll('.part-button.selected').forEach(button => {
                    uses.push(button.getAttribute('data-part'));
                });
                const detail = songGroup.querySelector(`#song-detail-${index + 1}`).value;

                songs.push({
                    Title: title,
                    Uses: uses,
                    detail: detail
                });
            });

            const jsonData = {
                name: bandName,
                songs: songs
            };

            const jsonString = JSON.stringify(jsonData, null, 4);
            downloadJSON(jsonString, `${bandName}.json`);
        });

        // JSONファイルをダウンロードする関数
        function downloadJSON(jsonString, filename) {
            const blob = new Blob([jsonString], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }
    </script>
</body>
</html>
